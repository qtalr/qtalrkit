```{r}
#| label: common
#| include: false

# Description: Common settings

# Packages ---------------------------------------------------------------
pacman::p_load(
  ggplot2,
  tibble,
  dplyr,
  tidyr,
  readr,
  stringr,
  reprex,
  rstudioapi,
  here,
  fs,
  rmarkdown,
  knitr,
  kableExtra,
  qtalrkit,
  fontawesome,
  webexercises
)

# automatically create a bib database for R packages
write_bib(c(
  "tidyverse", "readr", "rmarkdown", "dplyr", "usethis", "gitcreds",
  "quanteda", "textdata", "tidycensus", "sf", "rtweet", "skimr", "janitor",
  "ggplot2", "gridExtra", "reprex", "rvest", "fs", "purrr", "fontawesome", "webexercises"
), "packages.bib")


# Plots ------------------------------------------------------------------

# Plot theme
theme_qtalr <-
  function(font = "", font_size = 9) {
    ggplot2::theme_minimal() %+replace%

      ggplot2::theme(
        plot.title = ggplot2::element_text(
          family = font,
          size = font_size * 1.5
        ),
        plot.subtitle = ggplot2::element_text(
          family = font,
          size = font_size * 1.25
        ),
        plot.caption = ggplot2::element_text(
          family = font,
          size = font_size * 0.75
        ),
        axis.title = ggplot2::element_text(
          family = font,
          size = font_size
        ),
        axis.text = ggplot2::element_text(
          family = font,
          size = font_size * 0.75
        ),
        legend.title = ggplot2::element_text(
          family = font,
          size = font_size
        ),
        legend.text = ggplot2::element_text(
          family = font,
          size = font_size * 0.75
        )
      )
  }

# Set theme
ggplot2::theme_set(theme_qtalr())

# Color palettes

if (knitr::is_latex_output()) {
  # if output is latex, use greyscale palette
  custom_pal <- c("#000000", "#525252", "#717171", "#929292", "#BABABA", "#DADADA") # print palette
} else {
  # if output is not latex, use colorblind palette
  custom_pal <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7") # colorblind palette
}

# Set color palettes
scale_color_discrete <- function(...) {
  ggplot2::scale_color_manual(..., values = custom_pal)
}

# Set fill palettes
scale_fill_discrete <- function(...) {
  ggplot2::scale_fill_manual(..., values = custom_pal)
}

# Set linetype 
scale_linetype_discrete <- function(...) {
  ggplot2::scale_linetype_manual(..., values = c("solid", "dashed", "dotted", "dotdash", "longdash", "twodash"))
}

# Geom defaults 

update_geom_defaults("smooth", list(colour = "#525252"))
update_geom_defaults("point", list(colour = "#929292"))


# Options ----------------------------------------------------------------

options(digits = 3) # number of digits to print

# Misc -------------------------------------------------------------------

# Avoid conflict with stats::filter
filter <- dplyr::filter 

# Avoid kableextra from outputting HTML on kable tables
options(kableExtra.auto_format = FALSE)

# # Adjust linewidth
# hook_output <- knit_hooks$get("output") # get the default output hook

# knit_hooks$set(output = function(x, options) {
#   # this hook is used only when the linewidth option is not NULL
#   if (!is.null(n <- options$linewidth)) { # if linewidth is not NULL
#     x <- knitr:::split_lines(x) # split the output into lines
#     # any lines wider than n should be wrapped
#     x <- strwrap(x, width = n * getOption("width"))
#     x <- paste(x, collapse = "\n")
#   }
#   hook_output(x, options)
# })

knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  out.width = "100%",
  fig.align = "center",
  tidy = TRUE
)
```
