<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="qtalrkit">
<title>6. Organizing and documenting data • qtalrkit</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="6. Organizing and documenting data">
<meta property="og:description" content="qtalrkit">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">qtalrkit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/qtalrkit.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Materials</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/qtalr/qtalrkit/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>6. Organizing and documenting data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/qtalr/qtalrkit/blob/HEAD/vignettes/articles/recipe-6.Rmd" class="external-link"><code>vignettes/articles/recipe-6.Rmd</code></a></small>
      <div class="d-none name"><code>recipe-6.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<!--

Purpose: To review and expand on the concepts of data organization and documentation. This will also show practical examples of how to use `dplyr` and `stringr` to manipulate and parse semi-structured data.

Description: This recipe will showcase using regular expressions to parse semi-structured data and organize it into a tidy dataset. We will use the `readr, `dplyr`, `tidyr` and `stringr` packages. Along the way we will also use more advanced subsetting techniques, work with lists, and create custom functions to automate the process of parsing the semi-structured data.

Approach: We will use the Switchboard Dialog Act Corpus (swda) as an example. We will begin by exploring the data, develop code that parses a single file, then create a custom function to parse the semi-structured data into a tidy dataset  We will then apply this function to all of the conversation files in the corpus and combine the results into a single tidy dataset using the purrr package. We will not perform reshaping of rows or columns (leaving this for the next recipe).

Prerequisites: This recipe assumes that you have a basic understanding of the `readr` (read_*), `dplyr` (mutate), and `purrr` (unnest, map) packages and a basic understanding of Regular Expressions. Furthermore, it is assumed that you understand the role of data documentation in the research process.

Context: This is the second recipe in the "Preparation" part of the textbook. It follows the Acquire data and precedes the Transform data recipes. The accompanying lab for this recipe will continue with the options for forking/ cloning a project from GitHub, working with an existing project, and creating a new project. The lab is designed to be completed in a 50 minute class period.

-->
<p>After acquiring data, the next step in process is to organize data that is not tabular into a curated dataset. A curated dataset is a tidy dataset that reflects the data without major modifications. This dataset serves as a more general starting point for further data transformation.</p>
<p>Just as other aspects of the research process, it is important to document the process and the resulting dataset.</p>
<p>In this recipe, we will focus on curating data from a semi-structured format. In the process, we will cover the following topics:</p>
<ul>
<li>Reading and parsing semi-structured data</li>
<li>Creating a custom function and iterating over a collection of files</li>
<li>Combining the results into a single dataset</li>
<li>Documenting the data curation process and resulting dataset</li>
</ul>
<p>In the process, we will make use of the <code>readr</code>, <code>dplyr</code>, <code>stringr</code>, and <code>purrr</code> packages, employ regular expressions to parse the semi-structured data, and use the <code>qtalrkit</code> package to document the dataset. Let's load those packages now.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org" class="external-link">fs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/qtalr/qtalrkit" class="external-link">qtalrkit</a></span><span class="op">)</span></span></code></pre></div>
<p>In Lab 6, we will apply what we learn in this recipe to curate and document acquired data.</p>
</div>
<div class="section level2">
<h2 id="concepts-and-strategies">Concepts and strategies<a class="anchor" aria-label="anchor" href="#concepts-and-strategies"></a>
</h2>
<div class="section level3">
<h3 id="assessing-the-data">Assessing the data<a class="anchor" aria-label="anchor" href="#assessing-the-data"></a>
</h3>
<p>Acquired data can be in a variety of formats. This will range from unstructured data such as running text to structured data such as tabular data. Semi-structured data is somewhere in between. It has some structure, but it is not as well defined as structured data and requires some work to organize it into a tidy dataset.</p>
<p>As a semi-structured example we will work with the The Switchboard Dialog Act Corpus (SWDA) <span class="citation">(<a href="#ref-SWDA2008">University of Colorado Boulder 2008</a>)</span> which extends the <a href="https://catalog.ldc.upenn.edu/LDC97S62" class="external-link">Switchboard Corpus</a> with speech act annotation.</p>
<div class="callout">
<p><strong><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 64V241.6c5.2-1 10.5-1.6 16-1.6H96V208 64c0-8.8-7.2-16-16-16s-16 7.2-16 16zM80 288c-17.7 0-32 14.3-32 32c0 0 0 0 0 0v24c0 66.3 53.7 120 120 120h48c52.5 0 97.1-33.7 113.4-80.7c-3.1 .5-6.2 .7-9.4 .7c-20 0-37.9-9.2-49.7-23.6c-9 4.9-19.4 7.6-30.3 7.6c-15.1 0-29-5.3-40-14c-11 8.8-24.9 14-40 14H120c-13.3 0-24-10.7-24-24s10.7-24 24-24h40c8.8 0 16-7.2 16-16s-7.2-16-16-16H120 80zM0 320s0 0 0 0c0-18 6-34.6 16-48V64C16 28.7 44.7 0 80 0s64 28.7 64 64v82c5.1-1.3 10.5-2 16-2c25.3 0 47.2 14.7 57.6 36c7-2.6 14.5-4 22.4-4c20 0 37.9 9.2 49.7 23.6c9-4.9 19.4-7.6 30.3-7.6c35.3 0 64 28.7 64 64v64 24c0 92.8-75.2 168-168 168H168C75.2 512 0 436.8 0 344V320zm336-64c0-8.8-7.2-16-16-16s-16 7.2-16 16v48 16c0 8.8 7.2 16 16 16s16-7.2 16-16V256zM160 240c5.5 0 10.9 .7 16 2v-2V208c0-8.8-7.2-16-16-16s-16 7.2-16 16v32h16zm64 24v40c0 8.8 7.2 16 16 16s16-7.2 16-16V256 240c0-8.8-7.2-16-16-16s-16 7.2-16 16v24z"></path></svg> Tip</strong></p>
<p>If you would like to download and decompress the data yourself, you can do so by running the following code:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">qtalrkit</span><span class="fu">::</span><span class="fu"><a href="../reference/get_compressed_data.html">get_compressed_data</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"https://catalog.ldc.upenn.edu/docs/LDC97S62/swb1_dialogact_annot.tar.gz"</span>,</span>
<span>  target_dir <span class="op">=</span> <span class="st">"data/original/swda/"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>As a starting point, let's assume you have acquired the SWDA corpus and decompressed it into your project's <code>data/original/swda/</code> directory, as seen below.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="ex">└──</span> swda/</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>        <span class="ex">├──</span> doc/</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>        <span class="ex">├──</span> sw00utt/</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>        <span class="ex">├──</span> sw01utt/</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>        <span class="ex">├──</span> sw02utt/</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>        <span class="ex">├──</span> sw03utt/</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>        <span class="ex">├──</span> sw04utt/</span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>        <span class="ex">├──</span> sw05utt/</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>        <span class="ex">├──</span> sw06utt/</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>        <span class="ex">├──</span> sw07utt/</span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>        <span class="ex">├──</span> sw08utt/</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>        <span class="ex">├──</span> sw09utt/</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>        <span class="ex">├──</span> sw10utt/</span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>        <span class="ex">├──</span> sw11utt/</span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>        <span class="ex">├──</span> sw12utt/</span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>        <span class="ex">└──</span> sw13utt/</span></code></pre></div>
<p>The first step is to inspect the data directory and file structure (and of course any documentation files).</p>
<p>The <code>README</code> file contains basic information about the resource, the <code>doc/</code> directory contains more detailed information about the dialog annotations, and each of the following directories prefixed with <code>sw...</code> contain individual conversation files.</p>
<p>Taking a closer look at the first conversation file directory, <code>sw00utt/</code> we can see that it contains files with the <code>.utt</code> extension.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">├──</span> sw00utt</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0001_4325.utt</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0002_4330.utt</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0003_4103.utt</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0004_4327.utt</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="ex">│</span>   ├── sw_0005_4646.utt</span></code></pre></div>
<p>Let's take a look inside a conversation file (<code>sw_0001_4325.utt</code>) to see how it is structured internally. You can do this by opening the file in a text editor or by using the <code><a href="https://readr.tidyverse.org/reference/read_lines.html" class="external-link">read_lines()</a></code> function from the <code>readr</code> package.</p>
<pre><code><span><span class="co"># *x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># FILENAME: 4325_1632_1519</span></span>
<span><span class="co"># TOPIC#:       323</span></span>
<span><span class="co"># DATE:     920323</span></span>
<span><span class="co"># TRANSCRIBER:  glp</span></span>
<span><span class="co"># UTT_CODER:    tc</span></span>
<span><span class="co"># DIFFICULTY:   1</span></span>
<span><span class="co"># TOPICALITY:   3</span></span>
<span><span class="co"># NATURALNESS:  2</span></span>
<span><span class="co"># ECHO_FROM_B:  1</span></span>
<span><span class="co"># ECHO_FROM_A:  4</span></span>
<span><span class="co"># STATIC_ON_A:  1</span></span>
<span><span class="co"># STATIC_ON_B:  1</span></span>
<span><span class="co"># BACKGROUND_A: 1</span></span>
<span><span class="co"># BACKGROUND_B: 2</span></span>
<span><span class="co"># REMARKS:        None.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># =========================================================================</span></span>
<span><span class="co">#   </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># o          A.1 utt1: Okay.  /</span></span>
<span><span class="co"># qw          A.1 utt2: {D So, }   </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># qy^d          B.2 utt1: [ [ I guess, +   </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># +          A.3 utt1: What kind of experience [ do you, + do you ] have, then with child care? /  </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># +          B.4 utt1: I think, ] + {F uh, } I wonder ] if that worked. /  </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># qy          A.5 utt1: Does it say something? /  </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># sd          B.6 utt1: I think it usually does.  /</span></span></code></pre>
<p>There are few things to take note of here. First we see that the conversation files have a meta-data header offset from the conversation text by a line of <code>=</code> characters. Second the header contains meta-information of various types. Third, the conversation text is interleaved with an annotation scheme.</p>
<p>Some of the information may be readily understandable, such as the various pieces of meta-data in the header, but to get a better understanding of what information is encoded here let's take a look at the <code>README</code> file.</p>
<p>In this file we get a birds eye view of what is going on. In short, the data includes 1155 telephone conversations between two people annotated with 42 'DAMSL' dialog act labels. The <code>README</code> file refers us to the <code>doc/manual.august1.html</code> file for more information on this scheme.</p>
<p>At this point we open the the <code>doc/manual.august1.html</code> file in a browser and do some investigation. We find out that 'DAMSL' stands for 'Discourse Annotation and Markup System of Labeling' and that the first characters of each line of the conversation text correspond to one or a combination of labels for each utterance. So for our first utterances we have:</p>
<pre class="plain"><code>o = "Other"
qw = "Wh-Question"
qy^d = "Declarative Yes-No-Question"
+ = "Segment (multi-utterance)"</code></pre>
<p>Each utterance is also labeled for speaker ('A' or 'B'), speaker turn ('1', '2', '3', etc.), and each utterance within that turn ('utt1', 'utt2', etc.). There is other annotation provided withing each utterance, but this should be enough to get us started on the conversations.</p>
<p>Now let's turn to the meta-data in the header. We see here that there is information about the creation of the file: 'FILENAME', 'TOPIC', 'DATE', etc. The <code>doc/manual.august1.html</code> file doesn't have much to say about this information so I returned to the <a href="https://catalog.ldc.upenn.edu/docs/LDC97S62/" class="external-link">LDC Documentation</a> and found more information in the <a href="https://catalog.ldc.upenn.edu/docs/LDC97S62/" class="external-link">Online Documentation</a> section. After some poking around in this documentation I discovered that that meta-data for each speaker in the corpus is found in the <code>caller_tab.csv</code> file. This tabular file does not contain column names, but the <code>caller_doc.txt</code> does. After inspecting these files manually and comparing them with the information in the conversation file I noticed that the 'FILENAME' information contained three pieces of useful information delimited by underscores <code>_</code>.</p>
<pre class="plain"><code>*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*x*


FILENAME:   4325_1632_1519
TOPIC#:     323
DATE:       920323
TRANSCRIBER:    glp</code></pre>
<p>The first information is the document id (<code>4325</code>), the second and third correspond to the speaker number: the first being speaker A (<code>1632</code>) and the second speaker B (<code>1519</code>).</p>
<p>In sum, we have 1155 conversation files. Each file has two parts, a header and text section, separated by a line of <code>=</code> characters. The header section contains a 'FILENAME' line which has the document id, and ids for speaker A and speaker B. The text section is annotated with DAMSL tags beginning each line, followed by speaker, turn number, utterance number, and the utterance text. With this knowledge in hand, let's set out to create a tidy dataset with the column structure as in Table <a href="#tab:swda-idealized-dataset">1</a>.</p>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:swda-idealized-dataset">Table 1: </span>Idealized curated dataset
</caption>
<thead><tr>
<th style="text-align:left;">
doc_id
</th>
<th style="text-align:left;">
damsl_tag
</th>
<th style="text-align:left;">
speaker
</th>
<th style="text-align:left;">
turn_num
</th>
<th style="text-align:left;">
utterance_num
</th>
<th style="text-align:left;">
utterance_text
</th>
<th style="text-align:left;">
speaker_id
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
4325
</td>
<td style="text-align:left;">
o
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
Okay. /
</td>
<td style="text-align:left;">
1632
</td>
</tr>
<tr>
<td style="text-align:left;">
4325
</td>
<td style="text-align:left;">
qw
</td>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
{D So, }
</td>
<td style="text-align:left;">
1632
</td>
</tr>
<tr>
<td style="text-align:left;">
4325
</td>
<td style="text-align:left;">
qy^d
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
[ [ I guess, +
</td>
<td style="text-align:left;">
1519
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="tidy-the-data">Tidy the data<a class="anchor" aria-label="anchor" href="#tidy-the-data"></a>
</h3>
<p>There are many ways to approach the task of tidying the data in general, and this semi-structured data in particular. In this recipe, we will take a step-by-step approach to parsing the semi-structured data in one file and then apply this process to all of the files in the corpus using a custom function.</p>
<p>Let's begin by reading one of the conversation files into R as a character vector using the <code><a href="https://readr.tidyverse.org/reference/read_lines.html" class="external-link">read_lines()</a></code> function from the readr package.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read a single file as character vector</span></span>
<span><span class="va">doc_chr</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html" class="external-link">read_lines</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/original/swda/sw00utt/sw_0001_4325.utt"</span><span class="op">)</span></span></code></pre></div>
<p>To isolate the vector element that contains the document and speaker ids, we use <code><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset()</a></code> from the <code>stringr</code> package. This function takes two arguments, a string and a pattern, and returns any vector element that matches the pattern.</p>
<p>In this case we are looking for a pattern that matches three groups of digits separated by underscores. To test out a pattern, we can use the <code><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view()</a></code> function. We will use the regular expression character class <code>\\d</code> for digits and the <code>+</code> operator to match 1 or more contiguous digits. We then separate three groups of <code>\\d+</code> with underscores <code>_</code>. The result is <code>\\d+_\\d+_\\d+</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test out a pattern</span></span>
<span><span class="va">doc_chr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #555555;">[15] │</span> FILENAME:<span style="color: #00BBBB;">{\t}&lt;4325_1632_1519&gt;</span></span></span></code></pre>
<p>We can see that this pattern matches the line we are looking for. Now we can use this pattern with <code><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset()</a></code> to return the vector element that contains this pattern.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Isolate the vector element that contains the document and speaker ids</span></span>
<span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset</a></span><span class="op">(</span><span class="va">doc_chr</span>, <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "FILENAME:\t4325_1632_1519"</span></span></code></pre>
<div class="callout">
<p><strong><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 64V241.6c5.2-1 10.5-1.6 16-1.6H96V208 64c0-8.8-7.2-16-16-16s-16 7.2-16 16zM80 288c-17.7 0-32 14.3-32 32c0 0 0 0 0 0v24c0 66.3 53.7 120 120 120h48c52.5 0 97.1-33.7 113.4-80.7c-3.1 .5-6.2 .7-9.4 .7c-20 0-37.9-9.2-49.7-23.6c-9 4.9-19.4 7.6-30.3 7.6c-15.1 0-29-5.3-40-14c-11 8.8-24.9 14-40 14H120c-13.3 0-24-10.7-24-24s10.7-24 24-24h40c8.8 0 16-7.2 16-16s-7.2-16-16-16H120 80zM0 320s0 0 0 0c0-18 6-34.6 16-48V64C16 28.7 44.7 0 80 0s64 28.7 64 64v82c5.1-1.3 10.5-2 16-2c25.3 0 47.2 14.7 57.6 36c7-2.6 14.5-4 22.4-4c20 0 37.9 9.2 49.7 23.6c9-4.9 19.4-7.6 30.3-7.6c35.3 0 64 28.7 64 64v64 24c0 92.8-75.2 168-168 168H168C75.2 512 0 436.8 0 344V320zm336-64c0-8.8-7.2-16-16-16s-16 7.2-16 16v48 16c0 8.8 7.2 16 16 16s16-7.2 16-16V256zM160 240c5.5 0 10.9 .7 16 2v-2V208c0-8.8-7.2-16-16-16s-16 7.2-16 16v32h16zm64 24v40c0 8.8 7.2 16 16 16s16-7.2 16-16V256 240c0-8.8-7.2-16-16-16s-16 7.2-16 16v24z"></path></svg> Tip</strong></p>
<p>Regular Expressions are a powerful pattern matching syntax. They are used extensively in text manipulation and we will see them again and again.</p>
<p>To develop regular expressions, it is helpful to have a tool that allows you to interactively test your pattern matching. The stringr package has a handy function <code><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view()</a></code> which allows for interactive pattern matching. A good website to practice Regular Expressions is <a href="https://regex101.com/" class="external-link">RegEx101</a>. You can also install the <code>regexplain</code> package <span class="citation">(<a href="#ref-R-regexplain">Aden-Buie 2021</a>)</span> in R to get access to a useful <a href="https://rstudio.github.io/rstudioaddins/" class="external-link">RStudio Addin</a>.</p>
</div>
<p>The next step is to extract the three digit sequences that correspond to the <code>doc_id</code>, <code>speaker_a_id</code>, and <code>speaker_b_id</code>. First we extract the pattern that we have identified with <code><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract()</a></code> and then we can break up the single character vector into multiple parts based on the underscore <code>_</code>. The <code><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split()</a></code> function takes a string and then a pattern to use to split a character vector. It will return a list of character vectors.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset</a></span><span class="op">(</span><span class="va">doc_chr</span>, <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># isolate vector element</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># extract the pattern</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="st">"_"</span><span class="op">)</span> <span class="co"># split the character vector by underscore</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "4325" "1632" "1519"</span></span></code></pre>
<p>A list is a special object type in R. It is an unordered collection of objects whose lengths can differ (contrast this with a data frame which is a collection of objects whose lengths are the same --hence the tabular format).</p>
<p>In this case we have a list of length 1, whose sole element is a character vector of length 3 --one element per segment returned from our split. This is a desired result in most cases as if we were to pass multiple character vectors to our <code><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split()</a></code> function we don't want the results to be conflated as a single character vector blurring the distinction between the individual character vectors.</p>
<p>In this case, however, we want to extract the three elements of the character vector and assign them to meaningful variable names. To do this we will use the <code><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist()</a></code> function which will convert the list into a single character vector. We will assign this result to <code>speaker_info_chr</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">speaker_info_chr</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset</a></span><span class="op">(</span><span class="va">doc_chr</span>, <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># convert the list to a character vector</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="va">speaker_info_chr</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "4325" "1632" "1519"</span></span></code></pre>
<p><code>speaker_info_chr</code> is now a character vector of length three. Let's subset each of the elements and assign them to meaningful variable names so we can conveniently use them later on in the tidying process.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc_id</span> <span class="op">&lt;-</span> <span class="va">speaker_info_chr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># extract by index</span></span>
<span><span class="va">speaker_a_id</span> <span class="op">&lt;-</span> <span class="va">speaker_info_chr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="co"># extract by index</span></span>
<span><span class="va">speaker_b_id</span> <span class="op">&lt;-</span> <span class="va">speaker_info_chr</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="co"># extract by index</span></span></code></pre></div>
<p>The next step is to isolate the text section extracting it from rest of the document. As noted previously, a sequence of <code>=</code> separates the header section from the text section. What we need to do is to index the point in our character vector <code>doc_chr</code> where that line occurs and then subset the <code>doc_chr</code> from that point until the end of the character vector.</p>
<p>Let's first find the point where the <code>=</code> sequence occurs. We will again use the <code><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view()</a></code> to test out a pattern that matches a contiguous sequence of <code>=</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span><span class="va">doc_chr</span>, <span class="st">"=+"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #555555;">[31] │</span> <span style="color: #00BBBB;">&lt;=========================================================================&gt;</span></span></span></code></pre>
<p>So for this file we see there is one element that matches and that element's index is <code>31</code>.</p>
<p>Now it is important to keep in mind that we are working with a single file from the <code>swda/</code> data. Since our plan is to use this code to apply to other files, we need to be cautious to not create a pattern that may be matched multiple times in another document in the corpus. As the <code>=+</code> pattern will match <code>=</code>, or <code>==</code>, or <code>===</code>, etc. it is not implausible to believe that there might be a <code>=</code> character on some other line in one of the other files.</p>
<p>Let's update our regular expression to avoid this potential scenario by only matching sequences of three or more <code>=</code>. In this case we will make use of the curly bracket operators <code><a href="https://rdrr.io/r/base/Paren.html" class="external-link">{}</a></code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span><span class="va">doc_chr</span>, <span class="st">"={3,}"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #555555;">[31] │</span> <span style="color: #00BBBB;">&lt;=========================================================================&gt;</span></span></span></code></pre>
<p>We will get the same result for this file, but will safeguard ourselves a bit as it is unlikely we will find multiple matches for <code>===</code>, <code>====</code>, etc.</p>
<p>To extract just the index of the match, we can use the <code><a href="https://stringr.tidyverse.org/reference/str_which.html" class="external-link">str_which()</a></code> function with the same pattern. This will return the index of the vector element that matches the pattern. However, consider what we are doing. We actually are using this index to subset the vector, so we need to increment the index by 1 to get the next vector element. Let's do this and then assign the result to <code>text_start_index</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find where text starts</span></span>
<span><span class="va">text_start_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_which.html" class="external-link">str_which</a></span><span class="op">(</span><span class="va">doc_chr</span>, <span class="st">"={3,}"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span></code></pre></div>
<p>The index for the end of the text is simply the length of the <code>doc_chr</code> vector. We can use the <code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code> function to get this index.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find where text ends</span></span>
<span><span class="va">text_end_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">doc_chr</span><span class="op">)</span></span></code></pre></div>
<p>We now have the bookends, so to speak, for our text section. To extract the text we subset the <code>doc_chr</code> vector by these indices.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract text between indices</span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="va">doc_chr</span><span class="op">[</span><span class="va">text_start_index</span><span class="op">:</span><span class="va">text_end_index</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "  "                                       </span></span>
<span><span class="co">## [2] ""                                         </span></span>
<span><span class="co">## [3] "o          A.1 utt1: Okay.  /"            </span></span>
<span><span class="co">## [4] "qw          A.1 utt2: {D So, }   "        </span></span>
<span><span class="co">## [5] ""                                         </span></span>
<span><span class="co">## [6] "qy^d          B.2 utt1: [ [ I guess, +   "</span></span></code></pre>
<p>The text has some extra whitespace on some lines and there are blank lines as well. We should do some cleaning up before moving forward to organize the data. To get rid of the whitespace we use the <code><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim()</a></code> function which by default will remove leading and trailing whitespace from each line.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove leading and trailing whitespace</span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] ""                                      </span></span>
<span><span class="co">## [2] ""                                      </span></span>
<span><span class="co">## [3] "o          A.1 utt1: Okay.  /"         </span></span>
<span><span class="co">## [4] "qw          A.1 utt2: {D So, }"        </span></span>
<span><span class="co">## [5] ""                                      </span></span>
<span><span class="co">## [6] "qy^d          B.2 utt1: [ [ I guess, +"</span></span></code></pre>
<p>To remove blank lines we will use <code><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset()</a></code> to subset the <code>text</code> vector. The <code>.+</code> pattern will match elements that are not blank. We will assign the result to <code>text</code> overwriting the original <code>text</code> vector.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove blank lines</span></span>
<span><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">".+"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">text</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "o          A.1 utt1: Okay.  /"                                                                  </span></span>
<span><span class="co">## [2] "qw          A.1 utt2: {D So, }"                                                                 </span></span>
<span><span class="co">## [3] "qy^d          B.2 utt1: [ [ I guess, +"                                                         </span></span>
<span><span class="co">## [4] "+          A.3 utt1: What kind of experience [ do you, + do you ] have, then with child care? /"</span></span>
<span><span class="co">## [5] "+          B.4 utt1: I think, ] + {F uh, } I wonder ] if that worked. /"                        </span></span>
<span><span class="co">## [6] "qy          A.5 utt1: Does it say something? /"</span></span></code></pre>
<p>Our first step towards a tidy dataset is to now combine the <code>doc_id</code> and each element of <code>text</code> in a data frame, leaving aside our speaker ids. We will use the <code><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble()</a></code> function and pass the variables as named arguments.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Combine info and text into a data frame</span></span>
<span><span class="va">swda_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">text</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span><span class="va">swda_df</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 2</span></span></span>
<span><span class="co">##   doc_id text                                                                   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                                  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 4325   o          A.1 utt1: Okay.  /                                          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 4325   qw          A.1 utt2: {D So, }                                         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 4325   qy^d          B.2 utt1: [ [ I guess, +                                 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 4325   +          A.3 utt1: What kind of experience [ do you, + do you ] have…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 4325   +          B.4 utt1: I think, ] + {F uh, } I wonder ] if that worked. /</span></span></code></pre>
<p>With our data now in a data frame, it's time to parse the <code>text</code> column and extract the damsl tags, speaker, speaker turn, utterance number, and the utterance text itself into separate columns.</p>
<p>To do this we will make extensive use of regular expressions. Our aim is to find a consistent pattern that distinguishes each piece of information from other other text in a given row.</p>
<p>The best way to learn regular expressions is to use them. To this end I've included a link to the interactive regular expression practice website <a href="https://regex101.com" class="external-link">regex101</a>.</p>
<p>Open this site and copy the text below into the 'TEST STRING' field.</p>
<pre class="plain"><code>o          A.1 utt1: Okay.  /
qw          A.1 utt2: {D So, }
qy^d          B.2 utt1: [ [ I guess, +
+          A.3 utt1: What kind of experience [ do you, + do you ] have, then with child care? /
+          B.4 utt1: I think, ] + {F uh, } I wonder ] if that worked. /
qy          A.5 utt1: Does it say something? /
sd          B.6 utt1: I think it usually does.  /
ad          B.6 utt2: You might try, {F uh, }  /
h          B.6 utt3: I don't know,  /
ad          B.6 utt4: hold it down a little longer,  /</code></pre>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:regex-image"></span>
<img src="assets/images/recipe-6/regex-101.png" alt="RegEx101" width="100%"><p class="caption">
Figure 1: RegEx101
</p>
</div>
<p>Now manually type the following regular expressions into the 'REGULAR EXPRESSION' field one-by-one (each is on a separate line). Notice what is matched as you type and when you've finished typing. You can find out exactly what the component parts of each expression are doing by toggling the top right icon in the window or hovering your mouse over the relevant parts of the expression.</p>
<pre class="plain"><code>^.+?\s
[AB]\.\d+
utt\d+
:.+$</code></pre>
<p>As you can now see, we have regular expressions that will match the damsl tags, speaker and speaker turn, utterance number, and the utterance text.</p>
<p>To apply these expressions to our data and extract this information into separate columns we will make use of the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> and <code><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract()</a></code> functions. <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> will take our data frame and create new columns with values we match and extract from each row in the data frame with <code><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract()</a></code>.</p>
<div class="callout">
<p><strong><svg aria-hidden="true" role="img" viewbox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M64 64V241.6c5.2-1 10.5-1.6 16-1.6H96V208 64c0-8.8-7.2-16-16-16s-16 7.2-16 16zM80 288c-17.7 0-32 14.3-32 32c0 0 0 0 0 0v24c0 66.3 53.7 120 120 120h48c52.5 0 97.1-33.7 113.4-80.7c-3.1 .5-6.2 .7-9.4 .7c-20 0-37.9-9.2-49.7-23.6c-9 4.9-19.4 7.6-30.3 7.6c-15.1 0-29-5.3-40-14c-11 8.8-24.9 14-40 14H120c-13.3 0-24-10.7-24-24s10.7-24 24-24h40c8.8 0 16-7.2 16-16s-7.2-16-16-16H120 80zM0 320s0 0 0 0c0-18 6-34.6 16-48V64C16 28.7 44.7 0 80 0s64 28.7 64 64v82c5.1-1.3 10.5-2 16-2c25.3 0 47.2 14.7 57.6 36c7-2.6 14.5-4 22.4-4c20 0 37.9 9.2 49.7 23.6c9-4.9 19.4-7.6 30.3-7.6c35.3 0 64 28.7 64 64v64 24c0 92.8-75.2 168-168 168H168C75.2 512 0 436.8 0 344V320zm336-64c0-8.8-7.2-16-16-16s-16 7.2-16 16v48 16c0 8.8 7.2 16 16 16s16-7.2 16-16V256zM160 240c5.5 0 10.9 .7 16 2v-2V208c0-8.8-7.2-16-16-16s-16 7.2-16 16v32h16zm64 24v40c0 8.8 7.2 16 16 16s16-7.2 16-16V256 240c0-8.8-7.2-16-16-16s-16 7.2-16 16v24z"></path></svg> Tip</strong></p>
<p>Notice that <code><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract()</a></code> is different than <code><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract_all()</a></code>. When we work with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> each row will be evaluated in turn, therefore we only need to make one match per row.</p>
</div>
<p>I've chained each of these steps in the code below, dropping the original <code>text</code> column with <code>select(-text)</code>, and overwriting <code>swda_df</code> with the results.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract column information from `text`</span></span>
<span><span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">swda_df</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>damsl_tag <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"^.+?\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># damsl tags</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>speaker_turn <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"[AB]\\.\\d+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># speaker_turn pairs</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_num <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"utt\\d+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># utterance number</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">":.+$"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># utterance text</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span> <span class="co"># drop the `text` column</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">swda_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 159</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## $ doc_id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4325", "4325", "4325", "4325", "4325", "4325", "4325",…</span></span>
<span><span class="co">## $ damsl_tag      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "o ", "qw ", "qy^d ", "+ ", "+ ", "qy ", "sd ", "ad ", …</span></span>
<span><span class="co">## $ speaker_turn   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A.1", "A.1", "B.2", "A.3", "B.4", "A.5", "B.6", "B.6",…</span></span>
<span><span class="co">## $ utterance_num  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "utt1", "utt2", "utt1", "utt1", "utt1", "utt1", "utt1",…</span></span>
<span><span class="co">## $ utterance_text <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> ": Okay.  /", ": {D So, }", ": [ [ I guess, +", ": What…</span></span></code></pre>
<div class="callout">
<p><strong><svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"></path></svg> Warning</strong></p>
<p>One twist you will notice is that regular expressions in R require double backslashes (<code>\\</code>) where other programming environments use a single backslash (<code>\</code>).</p>
</div>
<p>There are a couple things left to do to the columns we extracted from the text before we move on to finishing up our tidy dataset. First, we need to separate the <code>speaker_turn</code> column into <code>speaker</code> and <code>turn_num</code> columns and second we need to remove unwanted characters from the <code>damsl_tag</code>, <code>utterance_num</code>, and <code>utterance_text</code> columns.</p>
<p>To separate the values of a column into two columns we use the <code>separate_wider_delim()</code> function. It takes a column to separate, a delimiter to use to separate the values, and a character vector of the names of the new columns to create.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Separate speaker_turn into distinct columns</span></span>
<span><span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">swda_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">separate_wider_delim</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">speaker_turn</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"."</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"speaker"</span>, <span class="st">"turn_num"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">swda_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 159</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## $ doc_id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4325", "4325", "4325", "4325", "4325", "4325", "4325",…</span></span>
<span><span class="co">## $ damsl_tag      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "o ", "qw ", "qy^d ", "+ ", "+ ", "qy ", "sd ", "ad ", …</span></span>
<span><span class="co">## $ speaker        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "B", "A", "B", "A", "B", "B", "B", "B", "B", …</span></span>
<span><span class="co">## $ turn_num       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "2", "3", "4", "5", "6", "6", "6", "6", "6", …</span></span>
<span><span class="co">## $ utterance_num  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "utt1", "utt2", "utt1", "utt1", "utt1", "utt1", "utt1",…</span></span>
<span><span class="co">## $ utterance_text <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> ": Okay.  /", ": {D So, }", ": [ [ I guess, +", ": What…</span></span></code></pre>
<p>To remove unwanted leading or trailing whitespace we apply the <code><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim()</a></code> function. For removing other characters we matching the character(s) and replace them with an empty string (<code>""</code>) with the <code><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace()</a></code> function. Again, I've chained these functions together and overwritten <code>data</code> with the results.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Clean up column information</span></span>
<span><span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">swda_df</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>damsl_tag <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">damsl_tag</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove leading/ trailing whitespace</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_num <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">utterance_num</span>, <span class="st">"utt"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove 'utt'</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">utterance_text</span>, <span class="st">":\\s"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove ': '</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">utterance_text</span><span class="op">)</span><span class="op">)</span> <span class="co"># trim leading/ trailing whitespace</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">swda_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 159</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## $ doc_id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4325", "4325", "4325", "4325", "4325", "4325", "4325",…</span></span>
<span><span class="co">## $ damsl_tag      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "o", "qw", "qy^d", "+", "+", "qy", "sd", "ad", "h", "ad…</span></span>
<span><span class="co">## $ speaker        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "B", "A", "B", "A", "B", "B", "B", "B", "B", …</span></span>
<span><span class="co">## $ turn_num       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "2", "3", "4", "5", "6", "6", "6", "6", "6", …</span></span>
<span><span class="co">## $ utterance_num  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "2", "1", "1", "1", "1", "1", "2", "3", "4", "5", …</span></span>
<span><span class="co">## $ utterance_text <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Okay.  /", "{D So, }", "[ [ I guess, +", "What kind of…</span></span></code></pre>
<p>To round out our tidy dataset for this single conversation file we will connect the <code>speaker_a_id</code> and <code>speaker_b_id</code> with speaker A and B in our current dataset adding a new column <code>speaker_id</code>. The <code><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when()</a></code> function does exactly this: allows us to map rows of <code>speaker</code> with the value "A" to <code>speaker_a_id</code> and rows with value "B" to <code>speaker_b_id</code>.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Link speaker with speaker_id</span></span>
<span><span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">swda_df</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>speaker_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span> <span class="co"># create speaker_id</span></span>
<span>    <span class="va">speaker</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">~</span> <span class="va">speaker_a_id</span>, <span class="co"># speaker_a_id value when A</span></span>
<span>    <span class="va">speaker</span> <span class="op">==</span> <span class="st">"B"</span> <span class="op">~</span> <span class="va">speaker_b_id</span>, <span class="co"># speaker_b_id value when B</span></span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span> <span class="co"># NA otherwise</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">swda_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 159</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ doc_id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4325", "4325", "4325", "4325", "4325", "4325", "4325",…</span></span>
<span><span class="co">## $ damsl_tag      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "o", "qw", "qy^d", "+", "+", "qy", "sd", "ad", "h", "ad…</span></span>
<span><span class="co">## $ speaker        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "B", "A", "B", "A", "B", "B", "B", "B", "B", …</span></span>
<span><span class="co">## $ turn_num       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "2", "3", "4", "5", "6", "6", "6", "6", "6", …</span></span>
<span><span class="co">## $ utterance_num  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "2", "1", "1", "1", "1", "1", "2", "3", "4", "5", …</span></span>
<span><span class="co">## $ utterance_text <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Okay.  /", "{D So, }", "[ [ I guess, +", "What kind of…</span></span>
<span><span class="co">## $ speaker_id     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1632", "1632", "1519", "1632", "1519", "1632", "1519",…</span></span></code></pre>
<p>We now have the tidy dataset we set out to create. But this dataset only includes one conversation file! We want to apply this code to all 1,155 conversation files in the <code>swda/</code> corpus.</p>
<p>The approach will be to create a custom function which groups the code we've done for this single file and then iteratively send each file from the corpus through this function and combine the results into one data frame.</p>
<p>Here's the custom function with some extra code to print a progress message for each file when it runs.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># [ ] add to `qtalrkit` package, note the convention of `extract_` prefix for curation functions. In combination with `get_compressed_data()` this corpus can be curated with few steps.</span></span>
<span></span>
<span><span class="va">extract_swda_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Progress message</span></span>
<span>  <span class="va">file_basename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="co"># file name</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Processing "</span>, <span class="va">file_basename</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Read `file` by lines</span></span>
<span>  <span class="va">doc_chr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html" class="external-link">read_lines</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Extract `doc_id`, `speaker_a_id`, and `speaker_b_id`</span></span>
<span>  <span class="va">speaker_info_chr</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset</a></span><span class="op">(</span><span class="va">doc_chr</span>, <span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="st">"\\d+_\\d+_\\d+"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="st">"_"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">doc_id</span> <span class="op">&lt;-</span> <span class="va">speaker_info_chr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">speaker_a_id</span> <span class="op">&lt;-</span> <span class="va">speaker_info_chr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">speaker_b_id</span> <span class="op">&lt;-</span> <span class="va">speaker_info_chr</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># Extract `text`</span></span>
<span>  <span class="va">text_start_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_which.html" class="external-link">str_which</a></span><span class="op">(</span><span class="va">doc_chr</span>, <span class="st">"={3,}"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">text_end_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">doc_chr</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">text</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">doc_chr</span><span class="op">[</span><span class="va">text_start_index</span><span class="op">:</span><span class="va">text_end_index</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html" class="external-link">str_subset</a></span><span class="op">(</span><span class="st">".+"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">swda_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">text</span><span class="op">)</span> <span class="co"># tidy format `doc_id` and `text`</span></span>
<span></span>
<span>  <span class="co"># Extract column information from `text`</span></span>
<span>  <span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">swda_df</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>damsl_tag <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"^.+?\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># damsl tags</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>speaker_turn <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"[AB]\\.\\d+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># speaker_turn pairs</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_num <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">"utt\\d+"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># utterance number</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">":.+$"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># utterance text</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span> <span class="co"># drop the `text` column</span></span>
<span></span>
<span>  <span class="co"># Separate speaker_turn into distinct columns</span></span>
<span>  <span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">swda_df</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>    <span class="fu">separate_wider_delim</span><span class="op">(</span></span>
<span>      cols <span class="op">=</span> <span class="va">speaker_turn</span>,</span>
<span>      delim <span class="op">=</span> <span class="st">"."</span>,</span>
<span>      names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"speaker"</span>, <span class="st">"turn_num"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Clean up column information</span></span>
<span>  <span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">swda_df</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>damsl_tag <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">damsl_tag</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove leading/ trailing whitespace</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_num <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">utterance_num</span>, <span class="st">"utt"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove 'utt'</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">utterance_text</span>, <span class="st">":\\s"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># remove ': '</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>utterance_text <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">utterance_text</span><span class="op">)</span><span class="op">)</span> <span class="co"># trim leading/ trailing whitespace</span></span>
<span></span>
<span>  <span class="co"># Link speaker with speaker_id</span></span>
<span>  <span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="va">swda_df</span> <span class="op">|&gt;</span> <span class="co"># current dataset</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>speaker_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span> <span class="co"># create speaker_id</span></span>
<span>      <span class="va">speaker</span> <span class="op">==</span> <span class="st">"A"</span> <span class="op">~</span> <span class="va">speaker_a_id</span>, <span class="co"># speaker_a_id value when A</span></span>
<span>      <span class="va">speaker</span> <span class="op">==</span> <span class="st">"B"</span> <span class="op">~</span> <span class="va">speaker_b_id</span> <span class="co"># speaker_b_id value when B</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Processed "</span>, <span class="va">file_basename</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">swda_df</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>As a sanity check we will run the <code>extract_swda_data()</code> function on a the conversation file we were just working on to make sure it works as expected.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process a single file (test)</span></span>
<span><span class="fu">extract_swda_data</span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="st">"../data/original/swda/sw00utt/sw_0001_4325.utt"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 159</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ doc_id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4325", "4325", "4325", "4325", "4325", "4325", "4325",…</span></span>
<span><span class="co">## $ damsl_tag      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "o", "qw", "qy^d", "+", "+", "qy", "sd", "ad", "h", "ad…</span></span>
<span><span class="co">## $ speaker        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "B", "A", "B", "A", "B", "B", "B", "B", "B", …</span></span>
<span><span class="co">## $ turn_num       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "2", "3", "4", "5", "6", "6", "6", "6", "6", …</span></span>
<span><span class="co">## $ utterance_num  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "2", "1", "1", "1", "1", "1", "2", "3", "4", "5", …</span></span>
<span><span class="co">## $ utterance_text <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Okay.  /", "{D So, }", "[ [ I guess, +", "What kind of…</span></span>
<span><span class="co">## $ speaker_id     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1632", "1632", "1519", "1632", "1519", "1632", "1519",…</span></span></code></pre>
<p>Looks good!</p>
<p>So now it's time to create a vector with the paths to all of the conversation files. The <code>ls_dif()</code> function from the <code>fs</code> package interfaces with our OS file system and will return the paths to the files in the specified directory. We also add a pattern to match conversation files (<code>regexp = \\.utt$</code>) so we don't accidentally include other files in the corpus. <code>recurse</code> set to <code>TRUE</code> means we will get the full path to each file.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List all conversation files</span></span>
<span><span class="va">swda_files_chr</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html" class="external-link">dir_ls</a></span><span class="op">(</span></span>
<span>    path <span class="op">=</span> <span class="st">"../data/original/swda/"</span>, <span class="co"># source directory</span></span>
<span>    recurse <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># traverse all sub-directories</span></span>
<span>    type <span class="op">=</span> <span class="st">"file"</span>, <span class="co"># only return files</span></span>
<span>    regexp <span class="op">=</span> <span class="st">"\\.utt$"</span></span>
<span>  <span class="op">)</span> <span class="co"># only return files ending in .utt</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">swda_files_chr</span><span class="op">)</span> <span class="co"># preview file paths</span></span></code></pre></div>
<pre class="plain"><code><span><span class="va">..</span><span class="op">/</span><span class="va">data</span><span class="op">/</span><span class="va">original</span><span class="op">/</span><span class="va">swda</span><span class="op">/</span><span class="va">sw00utt</span><span class="op">/</span><span class="va">sw_0001_4325.utt</span></span>
<span><span class="va">..</span><span class="op">/</span><span class="va">data</span><span class="op">/</span><span class="va">original</span><span class="op">/</span><span class="va">swda</span><span class="op">/</span><span class="va">sw00utt</span><span class="op">/</span><span class="va">sw_0002_4330.utt</span></span>
<span><span class="va">..</span><span class="op">/</span><span class="va">data</span><span class="op">/</span><span class="va">original</span><span class="op">/</span><span class="va">swda</span><span class="op">/</span><span class="va">sw00utt</span><span class="op">/</span><span class="va">sw_0003_4103.utt</span></span>
<span><span class="va">..</span><span class="op">/</span><span class="va">data</span><span class="op">/</span><span class="va">original</span><span class="op">/</span><span class="va">swda</span><span class="op">/</span><span class="va">sw00utt</span><span class="op">/</span><span class="va">sw_0004_4327.utt</span></span>
<span><span class="va">..</span><span class="op">/</span><span class="va">data</span><span class="op">/</span><span class="va">original</span><span class="op">/</span><span class="va">swda</span><span class="op">/</span><span class="va">sw00utt</span><span class="op">/</span><span class="va">sw_0005_4646.utt</span></span>
<span><span class="va">..</span><span class="op">/</span><span class="va">data</span><span class="op">/</span><span class="va">original</span><span class="op">/</span><span class="va">swda</span><span class="op">/</span><span class="va">sw00utt</span><span class="op">/</span><span class="va">sw_0006_4108.utt</span></span></code></pre>
<p>To pass each conversation file in the vector of paths to our conversation files iteratively to the <code>extract_swda_data()</code> function we use <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr()</a></code>. This will apply the function to each conversation file and return a data frame for each and then combine the results into a single data frame.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Process all conversation files</span></span>
<span><span class="va">swda_df</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">swda_files_chr</span> <span class="op">|&gt;</span> <span class="co"># pass file names</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="va">extract_swda_data</span><span class="op">)</span> <span class="co"># read and tidy iteratively</span></span>
<span></span>
<span><span class="co"># Preview</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">swda_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 223,606</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ doc_id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4325", "4325", "4325", "4325", "4325", "4325", "4325",…</span></span>
<span><span class="co">## $ damsl_tag      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "o", "qw", "qy^d", "+", "+", "qy", "sd", "ad", "h", "ad…</span></span>
<span><span class="co">## $ speaker        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "A", "A", "B", "A", "B", "A", "B", "B", "B", "B", "B", …</span></span>
<span><span class="co">## $ turn_num       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "1", "2", "3", "4", "5", "6", "6", "6", "6", "6", …</span></span>
<span><span class="co">## $ utterance_num  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1", "2", "1", "1", "1", "1", "1", "2", "3", "4", "5", …</span></span>
<span><span class="co">## $ utterance_text <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Okay.  /", "{D So, }", "[ [ I guess, +", "What kind of…</span></span>
<span><span class="co">## $ speaker_id     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1632", "1632", "1519", "1632", "1519", "1632", "1519",…</span></span></code></pre>
<p>We now see that we have 223, 606 observations (individual utterances in this dataset). The structure of the data frame matches our idealized dataset in Table <a href="#tab:swda-idealized-dataset">1</a>.</p>
<p>It also is a good idea to inspect the data frame to ensure that the data is as expected. One is to check for missing values. We can use the <code><a href="https://docs.ropensci.org/skimr/reference/skim.html" class="external-link">skim()</a></code> function from the <code>skimr</code> package to get a quick summary of the data frame. Another is to spot check the data frame to see if the values are as expected. As we are working with a fairly large dataset, we can use the <code><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample()</a></code> function from the <code>dplyr</code> package to randomly sample a subset of rows from the data frame.</p>
</div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h3>
<p>We now have a tidy dataset, but we need to document the data curation process and the resulting dataset. The script used to curate the data should be cleaned up and well documented in prose and code comments.</p>
<p>We then need to write the dataset to disk and create a data dictionary. We will make sure to add the curated dataset to the <code>derived/</code> directory and the data dictionary close to the dataset.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Write to disk</span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"../data/derived/swda/"</span><span class="op">)</span> <span class="co"># create swda subdirectory</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">swda_df</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"../data/derived/swda/swda_curated.csv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The directory structure now looks like this:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="ex">data/</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a><span class="ex">├──</span> analysis/</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a><span class="ex">│</span>   └── swda/</span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a><span class="ex">│</span>       └── swda_curated.csv</span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a>    <span class="ex">└──</span> swda/</span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a>        <span class="ex">├──</span> README</span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a>        <span class="ex">├──</span> doc/</span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a>        <span class="ex">├──</span> sw00utt/</span>
<span id="cb50-11"><a href="#cb50-11" tabindex="-1"></a>        <span class="ex">├──</span> sw01utt/</span>
<span id="cb50-12"><a href="#cb50-12" tabindex="-1"></a>        <span class="ex">├──</span> sw02utt/</span>
<span id="cb50-13"><a href="#cb50-13" tabindex="-1"></a>        <span class="ex">├──</span> sw03utt/</span>
<span id="cb50-14"><a href="#cb50-14" tabindex="-1"></a>        <span class="ex">├──</span> sw04utt/</span>
<span id="cb50-15"><a href="#cb50-15" tabindex="-1"></a>        <span class="ex">├──</span> sw05utt/</span>
<span id="cb50-16"><a href="#cb50-16" tabindex="-1"></a>        <span class="ex">├──</span> sw06utt/</span>
<span id="cb50-17"><a href="#cb50-17" tabindex="-1"></a>        <span class="ex">├──</span> sw07utt/</span>
<span id="cb50-18"><a href="#cb50-18" tabindex="-1"></a>        <span class="ex">├──</span> sw08utt/</span>
<span id="cb50-19"><a href="#cb50-19" tabindex="-1"></a>        <span class="ex">├──</span> sw09utt/</span>
<span id="cb50-20"><a href="#cb50-20" tabindex="-1"></a>        <span class="ex">├──</span> sw10utt/</span>
<span id="cb50-21"><a href="#cb50-21" tabindex="-1"></a>        <span class="ex">├──</span> sw11utt/</span>
<span id="cb50-22"><a href="#cb50-22" tabindex="-1"></a>        <span class="ex">├──</span> sw12utt/</span>
<span id="cb50-23"><a href="#cb50-23" tabindex="-1"></a>        <span class="ex">└──</span> sw13utt/</span></code></pre></div>
<p>The data dictionary file will contain information about the dataset variables and their values. This file can be created manually and edited with a text editor or spreadsheet software. Or alternatively, the scaffolding for a CSV file can be generated with the <code><a href="../reference/create_data_dictionary.html">create_data_dictionary()</a></code> function from the <code>qtalrkit</code> package.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create data dictionary</span></span>
<span><span class="fu"><a href="../reference/create_data_dictionary.html">create_data_dictionary</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">swda</span>,</span>
<span>  file_path <span class="op">=</span> <span class="st">"../data/derived/swda/swda_data_dictionary.csv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>In this recipe, we learned how to read and parse semi-structured data, create a custom function and iterate over a collection of files, combine the results into a single dataset, and document the data curation process and resulting dataset.</p>
<p>The skills we used in this recipe include regular expressions, the <code>readr</code>, <code>dplyr</code>, <code>stringr</code>, and <code>purrr</code> packages, and the <code>qtalrkit</code> package for documenting the dataset.</p>
</div>
<div class="section level2">
<h2 id="check-your-understanding">Check your understanding<a class="anchor" aria-label="anchor" href="#check-your-understanding"></a>
</h2>
<ol style="list-style-type: decimal">
<li>The first thing that should be done in the data curation process is to <select class="webex-select"><option value="blank"></option>
<option value="">know what packages you are going to use</option>
<option value="answer">explore the data documentation and understand the resource</option>
<option value="">read the data into R</option>
<option value="">parse the data into a tidy dataset</option></select>.</li>
<li>The <code><a href="https://readr.tidyverse.org/reference/read_lines.html" class="external-link">read_lines()</a></code> function from the <code>readr</code> package will read a file into R as a <select class="webex-select"><option value="blank"></option>
<option value="answer">character vector</option>
<option value="">data frame</option>
<option value="">list</option>
<option value="">matrix</option></select>.</li>
<li>
<select class="webex-select"><option value="blank"></option>
<option value="answer">TRUE</option>
<option value="">FALSE</option></select> The <code>separate_wider_delim()</code> function from the <code>tidyr</code> package will separate a column into two or more columns based on a delimiter (<em>e.g.</em> <code>-</code>, <code>.</code>, <em>etc.</em>).</li>
<li>Which of the following functions from the <code>stringr</code> package will return vector elements which contain a match for a pattern? <select class="webex-select"><option value="blank"></option>
<option value="answer">str_subset()</option>
<option value="">str_extract()</option>
<option value="">str_replace()</option>
<option value="">str_trim()</option></select>
</li>
<li>The <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr()</a></code> function from the <code>purrr</code> package will apply a function to each element of a vector and return a <select class="webex-select"><option value="blank"></option>
<option value="">list</option>
<option value="">nested data frame</option>
<option value="answer">data frame with rows combined</option>
<option value="">data frame with columns combined</option></select>.</li>
<li>A data dictionary is a document that describes the <select class="webex-select"><option value="blank"></option>
<option value="">data curation process</option>
<option value="">data analysis process</option>
<option value="answer">dataset variables and their values</option>
<option value="">data visualization process</option></select>.</li>
</ol>
</div>
<div class="section level2">
<h2 id="lab-preparation">Lab preparation<a class="anchor" aria-label="anchor" href="#lab-preparation"></a>
</h2>
<p>Before beginning <a href="https://github.com/qtalr/lab-06" class="external-link">Lab 6</a>, review and ensure that you are familiar with the following:</p>
<ul>
<li>Vector, data frame, and list data structures</li>
<li>Subsetting and indexing vectors, data frames, and lists</li>
<li>Basic regular expressions such as character classes, quantifiers, and anchors</li>
<li>Reading, writing, and manipulating files</li>
<li>Creating and employing custom functions</li>
</ul>
<p>In this lab, we will practice these skills and expand our use of the <code>readr</code>, <code>dplyr</code>, <code>stringr</code>, and <code>purrr</code> packages to curate and document a dataset.</p>
<p>You will have a choice of data to curate. Before you start the lab, you should consider which data source you would like to use, what the idealized structure the curated dataset will take, and what strategies you will likely employ to curate the dataset. You should also consider the information you need to document the data curation process.</p>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-R-regexplain" class="csl-entry">
Aden-Buie, Garrick. 2021. <em>Regexplain: Rstudio Addin to Explain, Test and Build Regular Expressions</em>. <a href="https://github.com/gadenbuie/regexplain" class="external-link">https://github.com/gadenbuie/regexplain</a>.
</div>
<div id="ref-SWDA2008" class="csl-entry">
University of Colorado Boulder. 2008. <span>“Switchboard Dialog Act Corpus. Web Download.”</span> Linguistic Data Consortium.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>

<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script><footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jerid Francom.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
